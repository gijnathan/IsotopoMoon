cpp reproduction of the functions in python_model
